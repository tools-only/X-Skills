# ä» v4.2 è¿ç§»åˆ° v5.0 - Context Engineering

> **é‡è¦**: è¿™æ˜¯ä¸€ä¸ªé‡å¤§å‡çº§ï¼Œå¼•å…¥äº†å…¨æ–°çš„ Context Engineering æ¶æ„

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¦è¿ç§»ï¼Ÿ

### Before (v4.2)
```
CLAUDE.md: 20KBï¼ˆåŒ…å«å¤§é‡è¯¦ç»†å†…å®¹ï¼‰
+ è§„åˆ™æ–‡ä»¶: 30KBï¼ˆå…¨å±€+é¡¹ç›®é‡å¤ï¼‰
+ èƒ½åŠ›æ–‡æ¡£: 70KBï¼ˆéƒ¨åˆ†åŠ è½½ï¼‰
= æ€»è®¡: 120KB (60% context å ç”¨)
```

**é—®é¢˜**:
- âŒ å¤§é‡ä¸ç›¸å…³å†…å®¹è¢«åŠ è½½
- âŒ ä¸Šä¸‹æ–‡è…çƒ‚
- âŒ é‡å¤çš„è§„åˆ™æ–‡ä»¶
- âŒ æ²¡æœ‰æ™ºèƒ½åŠ è½½æœºåˆ¶

### After (v5.0)
```
CLAUDE.md: 5KBï¼ˆçº¯ç´¢å¼• + æ ¸å¿ƒåŸåˆ™ï¼‰
+ æ ¸å¿ƒè§„åˆ™: 10KBï¼ˆæ€»æ˜¯åŠ è½½ï¼‰
+ æŒ‰éœ€åŠ è½½: 20-30KBï¼ˆæ ¹æ®ä»»åŠ¡ç±»å‹ï¼‰
= æ€»è®¡: 35-45KB (18-23% context å ç”¨)
```

**æ”¹è¿›**:
- âœ… æ™ºèƒ½æŒ‰éœ€åŠ è½½
- âœ… Context èŠ‚çœ ~75KB
- âœ… Free context ä» 40% â†’ 77%+
- âœ… æ¸…æ™°çš„ Subagent æ¶æ„
- âœ… Progressive Disclosure

---

## ğŸ“‹ è¿ç§»æ­¥éª¤

### Step 1: å¤‡ä»½ç°æœ‰é…ç½®

```bash
# å¤‡ä»½å½“å‰çš„ CLAUDE.md
cp ~/.claude/CLAUDE.md ~/.claude/CLAUDE_v4.2_backup.md

# å¤‡ä»½è§„åˆ™æ–‡ä»¶
cp -r ~/.claude/rules ~/.claude/rules_v4.2_backup
```

### Step 2: æ›¿æ¢ä¸»ç´¢å¼•æ–‡ä»¶

```bash
# ä½¿ç”¨æ–°çš„ CLAUDE.md
mv ~/.claude/CLAUDE_v5.md ~/.claude/CLAUDE.md
```

### Step 3: é‡ç»„è§„åˆ™æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡åšï¼‰

```bash
# ç§»åŠ¨ç°æœ‰è§„åˆ™åˆ° domain ç›®å½•
mv ~/.claude/rules/coding-style.md ~/.claude/rules/domain/coding.md
mv ~/.claude/rules/testing.md ~/.claude/rules/domain/testing.md
mv ~/.claude/rules/security.md ~/.claude/rules/domain/security.md
mv ~/.claude/rules/git-workflow.md ~/.claude/rules/domain/git.md
```

### Step 4: æ¸…ç†é‡å¤æ–‡ä»¶

```bash
# åˆ é™¤é¡¹ç›®çº§çš„é‡å¤è§„åˆ™ï¼ˆå¦‚æœæœ‰ï¼‰
# ç°åœ¨ç»Ÿä¸€ä½¿ç”¨å…¨å±€è§„åˆ™ï¼ŒæŒ‰éœ€åŠ è½½
rm -rf "E:\Bobo's Coding cache\.claude\rules"
```

### Step 5: éªŒè¯æ–°æ¶æ„

```bash
# æ£€æŸ¥æ ¸å¿ƒæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls ~/.claude/CLAUDE.md
ls ~/.claude/CONTEXT_MANAGER.md
ls ~/.claude/index/task-router.md
ls ~/.claude/rules/core/work-mode.md
ls ~/.claude/rules/core/blocking-rules.md
```

---

## ğŸ†• æ–°å¢æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒç³»ç»Ÿæ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | å¤§å° |
|------|------|------|
| `CLAUDE.md` | ä¸»ç´¢å¼• + æ ¸å¿ƒåŸåˆ™ | 5KB |
| `CONTEXT_MANAGER.md` | æ™ºèƒ½åŠ è½½è§„åˆ™ | 10KB |
| `CONTEXT_ENGINEERING_PLAN.md` | å®Œæ•´è®¾è®¡æ–¹æ¡ˆ | 15KB |
| `MIGRATION_GUIDE.md` | è¿ç§»æŒ‡å—ï¼ˆæœ¬æ–‡ä»¶ï¼‰ | 8KB |

### ç´¢å¼•æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | å¤§å° |
|------|------|------|
| `index/task-router.md` | ä»»åŠ¡è·¯ç”±å†³ç­–æ ‘ | 8KB |
| `index/capabilities-index.md` | èƒ½åŠ›ç´¢å¼•ï¼ˆå¾…åˆ›å»ºï¼‰ | 3KB |
| `index/tools-index.md` | å·¥å…·ç´¢å¼•ï¼ˆå¾…åˆ›å»ºï¼‰ | 3KB |
| `index/error-patterns-index.md` | é”™è¯¯ç´¢å¼•ï¼ˆå¾…åˆ›å»ºï¼‰ | 3KB |

### æ ¸å¿ƒè§„åˆ™

| æ–‡ä»¶ | ç”¨é€” | å¤§å° |
|------|------|------|
| `rules/core/work-mode.md` | 4æ­¥å·¥ä½œæ¨¡å¼ | 5KB |
| `rules/core/blocking-rules.md` | 4ç§è‡´å‘½é˜»å¡ | 5KB |

### é¢†åŸŸè§„åˆ™ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰

| æ–‡ä»¶ | ç”¨é€” | å¤§å° |
|------|------|------|
| `rules/domain/coding.md` | ç¼–ç é£æ ¼è§„åˆ™ | 5KB |
| `rules/domain/testing.md` | æµ‹è¯•è¦æ±‚ | 5KB |
| `rules/domain/security.md` | å®‰å…¨è§„åˆ™ | 5KB |
| `rules/domain/git.md` | Git å·¥ä½œæµ | 5KB |

### Subagent å®šä¹‰

| æ–‡ä»¶ | ç”¨é€” | å¤§å° |
|------|------|------|
| `agents/SUBAGENT_ARCHITECTURE.md` | æ¶æ„è¯´æ˜ | 12KB |
| `agents/context-manager-agent.md` | Context Managerï¼ˆå¾…åˆ›å»ºï¼‰ | 3KB |
| `agents/task-router-agent.md` | Task Routerï¼ˆå¾…åˆ›å»ºï¼‰ | 3KB |

### é”™è¯¯åº“

| æ–‡ä»¶ | ç”¨é€” | å¤§å° |
|------|------|------|
| `errors/top-5-errors.md` | é«˜é¢‘é”™è¯¯å¿«é€Ÿå‚è€ƒ | 6KB |
| `errors/ERROR_CATALOG.md` | å®Œæ•´é”™è¯¯ç›®å½• | 30KB |

---

## ğŸ”„ ä½¿ç”¨å˜åŒ–

### Before (v4.2)

**å¯åŠ¨æ—¶**:
- åŠ è½½ CLAUDE.md (20KB)
- åŠ è½½æ‰€æœ‰è§„åˆ™æ–‡ä»¶ (30KB)
- éƒ¨åˆ†èƒ½åŠ›æ–‡æ¡£è‡ªåŠ¨åŠ è½½ (70KB)

**æ€»æ˜¯ä½¿ç”¨ 120KB context**

### After (v5.0)

**å¯åŠ¨æ—¶**:
- åŠ è½½ CLAUDE.md (5KB)
- åŠ è½½æ ¸å¿ƒè§„åˆ™ (10KB)

**ä»»åŠ¡è¯†åˆ«å**:
- è‡ªåŠ¨åŠ è½½ç›¸å…³æ–‡æ¡£ (15-30KB)

**æ€»å…±ä½¿ç”¨ 30-45KB context**

---

## ğŸ“– æ–°çš„å·¥ä½œæµç¨‹

### 1. ç”¨æˆ·æå‡ºè¯·æ±‚

```
"å¸®æˆ‘åšä¸€ä¸ªæµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬"
```

### 2. ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«ä»»åŠ¡ç±»å‹

```
è¯†åˆ«: browser-automation
```

### 3. Context Manager è‡ªåŠ¨åŠ è½½æ–‡æ¡£

```
åŠ è½½:
  - CLAUDE.md (5KB)
  - rules/core/work-mode.md (5KB)
  - rules/core/blocking-rules.md (5KB)
  - rules/domain/coding.md (5KB)
  - capabilities/browser-automation/decision-tree.md (8KB)

æ€»è®¡: 28KB
```

### 4. Task Router é€‰æ‹© Agent

```
é€‰æ‹©: Browser Automation Agent
å·¥å…·: playwright (MCP)
```

### 5. æ‰§è¡Œä»»åŠ¡

```
Agent ä½¿ç”¨åŠ è½½çš„æ–‡æ¡£æ‰§è¡Œä»»åŠ¡
```

### 6. è¿”å›ç»“æœ

```
å®Œæˆï¼Œcontext ä½¿ç”¨: 28KB (14%)
Free context: 172KB (86%)
```

---

## âœ… éªŒè¯è¿ç§»æˆåŠŸ

### æµ‹è¯•æ¡ˆä¾‹ 1: æµè§ˆå™¨è‡ªåŠ¨åŒ–

```
ç”¨æˆ·: "ç”¨ Playwright æ‰“å¼€ Google å¹¶æœç´¢"

é¢„æœŸ:
  âœ“ è‡ªåŠ¨è¯†åˆ« browser-automation
  âœ“ åŠ è½½ decision-tree.md
  âœ“ Context ä½¿ç”¨ <30KB
  âœ“ æˆåŠŸæ‰§è¡Œä»»åŠ¡
```

### æµ‹è¯•æ¡ˆä¾‹ 2: è§†é¢‘åˆ›ä½œ

```
ç”¨æˆ·: "åšä¸€ä¸ª30ç§’çš„äº§å“ä»‹ç»è§†é¢‘"

é¢„æœŸ:
  âœ“ è‡ªåŠ¨è¯†åˆ« video-creation
  âœ“ åŠ è½½ remotion-guide.md
  âœ“ Context ä½¿ç”¨ <40KB
  âœ“ è¾“å‡ºå®Œæ•´ Remotion é¡¹ç›®
```

### æµ‹è¯•æ¡ˆä¾‹ 3: æ•°æ®åˆ†æ

```
ç”¨æˆ·: "æŸ¥è¯¢æœ€è¿‘7å¤©çš„ç”¨æˆ·å¢é•¿æ•°æ®"

é¢„æœŸ:
  âœ“ è‡ªåŠ¨è¯†åˆ« data-analysis
  âœ“ åŠ è½½ data-analysis-guide.md
  âœ“ Context ä½¿ç”¨ <35KB
  âœ“ ç”Ÿæˆä¼˜åŒ–çš„ SQL æŸ¥è¯¢
```

---

## ğŸ†š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | v4.2 | v5.0 |
|------|------|------|
| **ä¸»ç´¢å¼•å¤§å°** | 20KB | 5KB âœ… |
| **Context ä½¿ç”¨** | 120KB (60%) | 35-45KB (18-23%) âœ… |
| **æ™ºèƒ½åŠ è½½** | âŒ | âœ… |
| **Subagent æ¶æ„** | âŒ | âœ… |
| **Progressive Disclosure** | âŒ | âœ… |
| **æŒ‰éœ€åŠ è½½** | âŒ | âœ… |
| **ä»»åŠ¡è·¯ç”±** | âŒ | âœ… |
| **Context ä¼˜åŒ–** | âŒ | âœ… |

---

## ğŸ“ å­¦ä¹ æ–°ç³»ç»Ÿ

### å¿«é€Ÿä¸Šæ‰‹ï¼ˆ5åˆ†é’Ÿï¼‰

1. **é˜…è¯» CLAUDE.md** (5KB)
   - æ ¸å¿ƒåŸåˆ™
   - å¿«é€Ÿç´¢å¼•

2. **æµè§ˆ index/task-router.md** (8KB)
   - æ‰¾åˆ°ä½ éœ€è¦çš„èƒ½åŠ›
   - 30ç§’å¿«é€Ÿå¯¼èˆª

3. **å¼€å§‹å·¥ä½œ**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½å¿…éœ€æ–‡æ¡£
   - æ— éœ€æ‰‹åŠ¨ç®¡ç† context

### æ·±å…¥ç†è§£ï¼ˆ30åˆ†é’Ÿï¼‰

1. **Context Engineering**
   - `CONTEXT_MANAGER.md` - åŠ è½½è§„åˆ™
   - `CONTEXT_ENGINEERING_PLAN.md` - å®Œæ•´è®¾è®¡

2. **Subagent æ¶æ„**
   - `agents/SUBAGENT_ARCHITECTURE.md` - æ¶æ„è¯´æ˜
   - ç†è§£ agent åä½œæµç¨‹

3. **å®è·µæµ‹è¯•**
   - å°è¯•ä¸åŒç±»å‹çš„ä»»åŠ¡
   - è§‚å¯Ÿ context ä½¿ç”¨æƒ…å†µ

---

## â“ å¸¸è§é—®é¢˜

### Q1: æˆ‘çš„æ—§æ–‡æ¡£è¿˜èƒ½ç”¨å—ï¼Ÿ

âœ… **èƒ½ç”¨**ã€‚æ‰€æœ‰ç°æœ‰èƒ½åŠ›æ–‡æ¡£ï¼ˆcapabilities/ï¼‰éƒ½ä¿æŒä¸å˜ï¼Œåªæ˜¯åŠ è½½æ–¹å¼æ”¹ä¸ºæŒ‰éœ€åŠ è½½ã€‚

### Q2: éœ€è¦æ‰‹åŠ¨æŒ‡å®šåŠ è½½å“ªäº›æ–‡æ¡£å—ï¼Ÿ

âŒ **ä¸éœ€è¦**ã€‚ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„è¯·æ±‚è‡ªåŠ¨è¯†åˆ«ä»»åŠ¡ç±»å‹å¹¶åŠ è½½ç›¸å…³æ–‡æ¡£ã€‚

### Q3: å¦‚æœè‡ªåŠ¨è¯†åˆ«é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

å¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼š
```
@load capabilities/browser-automation/decision-tree.md
```

### Q4: v4.2 çš„åŠŸèƒ½ä¼šä¸¢å¤±å—ï¼Ÿ

âŒ **ä¸ä¼š**ã€‚æ‰€æœ‰åŠŸèƒ½éƒ½ä¿ç•™ï¼Œåªæ˜¯ç»„ç»‡æ–¹å¼æ›´ä¼˜åŒ–äº†ã€‚

### Q5: è¿ç§»ä¼šå½±å“æ­£åœ¨è¿›è¡Œçš„é¡¹ç›®å—ï¼Ÿ

âŒ **ä¸ä¼š**ã€‚è¿™æ˜¯æœ¬åœ°é…ç½®ä¼˜åŒ–ï¼Œä¸å½±å“é¡¹ç›®ä»£ç ã€‚

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: "æ‰¾ä¸åˆ° CLAUDE.md"

```bash
# ç¡®è®¤æ–‡ä»¶å­˜åœ¨
ls ~/.claude/CLAUDE.md

# å¦‚æœä¸å­˜åœ¨ï¼Œé‡æ–°åˆ›å»º
cp ~/.claude/CLAUDE_v5.md ~/.claude/CLAUDE.md
```

### é—®é¢˜ 2: "æŸä¸ªèƒ½åŠ›æ–‡æ¡£åŠ è½½å¤±è´¥"

```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls ~/.claude/capabilities/browser-automation/decision-tree.md

# å¦‚æœä¸å­˜åœ¨ï¼Œå¯èƒ½è·¯å¾„é”™è¯¯ï¼Œæ£€æŸ¥ CONTEXT_MANAGER.md ä¸­çš„æ˜ å°„
```

### é—®é¢˜ 3: "Context ä½¿ç”¨ä»ç„¶å¾ˆé«˜"

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æœªæ¸…ç†çš„æ—§è§„åˆ™
ls ~/.claude/rules/

# åº”è¯¥åªæœ‰ core/ å’Œ domain/ ä¸¤ä¸ªç›®å½•
# å¦‚æœæœ‰å…¶ä»–æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯æ—§ç‰ˆæœ¬æ®‹ç•™
```

---

## ğŸ“Š æ€§èƒ½æå‡

### Context ä½¿ç”¨å¯¹æ¯”

```
ä»»åŠ¡: æµè§ˆå™¨è‡ªåŠ¨åŒ–

v4.2:
  CLAUDE.md: 20KB
  + rules: 30KB
  + capabilities: 70KB
  = 120KB (60%)

v5.0:
  CLAUDE.md: 5KB
  + core rules: 10KB
  + browser-automation: 8KB
  = 23KB (12%)

èŠ‚çœ: 97KB (48% â†’ 12%)
```

### å“åº”é€Ÿåº¦æå‡

```
v4.2: åŠ è½½ 120KB â†’ åˆ†æ â†’ å“åº”
v5.0: åŠ è½½ 23KB â†’ åˆ†æ â†’ å“åº”

åŠ è½½æ—¶é—´å‡å°‘: ~80%
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

è¿ç§»å®Œæˆåï¼š

1. **æµ‹è¯•å„ç§ä»»åŠ¡ç±»å‹**
   - æµè§ˆå™¨è‡ªåŠ¨åŒ–
   - è§†é¢‘åˆ›ä½œ
   - æ•°æ®åˆ†æ
   - UI è®¾è®¡

2. **ç›‘æ§ Context ä½¿ç”¨**
   - è§‚å¯ŸåŠ è½½äº†å“ªäº›æ–‡æ¡£
   - æ˜¯å¦ç¬¦åˆé¢„æœŸ

3. **æä¾›åé¦ˆ**
   - è¯†åˆ«ä¸å‡†ç¡®çš„æƒ…å†µ
   - å»ºè®®æ”¹è¿›

4. **äº«å—æ›´é«˜æ•ˆçš„å·¥ä½œæµç¨‹**
   - æ›´å°‘çš„ context å ç”¨
   - æ›´å¿«çš„å“åº”é€Ÿåº¦
   - æ›´æ¸…æ™°çš„ç»„ç»‡ç»“æ„

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `CLAUDE.md` - ä¸»ç´¢å¼•ï¼ˆæ–°ç‰ˆï¼‰
- `CONTEXT_MANAGER.md` - Context åŠ è½½è§„åˆ™
- `CONTEXT_ENGINEERING_PLAN.md` - å®Œæ•´è®¾è®¡æ–¹æ¡ˆ
- `agents/SUBAGENT_ARCHITECTURE.md` - Subagent æ¶æ„
- `index/task-router.md` - ä»»åŠ¡è·¯ç”±å†³ç­–æ ‘

---

**ç‰ˆæœ¬**: v1.0
**è¿ç§»**: v4.2 â†’ v5.0
**æ›´æ–°**: 2026-02-05
**çŠ¶æ€**: Ready for Production
