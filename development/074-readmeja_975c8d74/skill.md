# ğŸ“˜ Maestro Orchestrator â€” ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆfail-closed + HITLï¼‰

## 1) Context flowï¼ˆæ–‡è„ˆãƒ•ãƒ­ãƒ¼ï¼‰

### Context Flow Diagram

- **Perception** â€” å…¥åŠ›ã‚’å®Ÿè¡Œå¯èƒ½è¦ç´ ã¸åˆ†è§£ï¼ˆã‚¿ã‚¹ã‚¯åŒ–ï¼‰
- **Context** â€” ä»®å®šï¼åˆ¶ç´„ï¼ãƒªã‚¹ã‚¯è¦å› ã‚’æŠ½å‡ºï¼ˆã‚¬ãƒ¼ãƒ‰ç†ç”±ï¼‰
- **Action** â€” å®Ÿè¡Œè€…ã¸æŒ‡ç¤ºã€çµæœæ¤œè¨¼ã€åˆ†å²ï¼ˆSTOP / REROUTE / HITLï¼‰

---

## 2) Orchestrator one-page design mapï¼ˆ1æšè¨­è¨ˆå›³ï¼‰

### Decision flow mapï¼ˆå®Ÿè£…æº–æ‹ ï¼‰

`mediator_advice â†’ Meaning â†’ Consistency â†’ RFL â†’ Ethics â†’ ACC â†’ DISPATCH`

**fail-closed å‰æ**ï¼šãƒªã‚¹ã‚¯ï¼æ›–æ˜§ã•ãŒã‚ã‚Œã° **PAUSE_FOR_HITL** ã¾ãŸã¯ **STOPPED** ã«å€’ã—ã€ã€Œãªãœã€ã‚’ãƒ­ã‚°ã«æ®‹ã—ã¾ã™ã€‚

### Orchestrator one-page design map

ç”»åƒãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼ˆã¾ãŸã¯å°ã•ã„ï¼‰å ´åˆã¯ç›´æ¥é–‹ã„ã¦ãã ã•ã„ï¼š

- `docs/orchestrator_onepage_design_map.png`

> **RFL ã¯éå°å°ï¼ˆnon-sealingï¼‰è¨­è¨ˆ**ã§ã™ï¼šRFL ã¯ **PAUSE_FOR_HITL** ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ãƒˆã—ã€`sealed=true` ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚

---

## 3) Architectureï¼ˆæ§‹æˆå›³ï¼‰

ç›£æŸ»å¯èƒ½ï¼ˆaudit-readyï¼‰ã‹ã¤ fail-closed ãªåˆ¶å¾¡ãƒ•ãƒ­ãƒ¼ã®å…¨ä½“åƒï¼š

`agents â†’ mediatorï¼ˆrisk / pattern / factï¼‰â†’ evidence verification â†’ HITLï¼ˆreset / banï¼‰â†’ audit logs`

### Architecture (unknown progress + HITL)

ç”»åƒãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼ˆã¾ãŸã¯å°ã•ã„ï¼‰å ´åˆã¯ç›´æ¥é–‹ã„ã¦ãã ã•ã„ï¼š

- `docs/architecture_unknown_progress.png`

---

## ğŸ†• å¤‰æ›´ç‚¹ï¼ˆ2026-01-21ï¼‰

- **New**: `ai_mediation_hitl_reset_full_with_unknown_progress.py`  
  æ¤œè¨¼ä¸èƒ½ãªé€²æ—ï¼ˆunknown progressï¼‰ã‚’æ‰±ã†ãŸã‚ã® **HITL/RESET ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹æ¤œè¨¼**ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã€‚

- **New**: `ai_mediation_hitl_reset_full_kage_arlå…¬é–‹ç”¨_rfl_relcodes_branches.py`  
  **KAGE v1.7-IEP** ã® **RFL relcode åˆ†å²**ï¼ˆRFL ã¯éå°å°â†’HITLï¼‰ã‚’æ¤œè¨¼ã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã€‚

- **Updated**: `ai_doc_orchestrator_kage3_v1_2_4.py`  
  Doc orchestrator ã®å‚ç…§å®Ÿè£…ï¼ˆ**post-HITL ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹**ï¼‰æ›´æ–°ã€‚

---

## ğŸ§¾ ç›£æŸ»ãƒ­ã‚° & ãƒ‡ãƒ¼ã‚¿å®‰å…¨ï¼ˆIMPORTANTï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€å†ç¾æ€§ã¨èª¬æ˜è²¬ä»»ã®ãŸã‚ã« **ç›£æŸ»ãƒ­ã‚°ï¼ˆaudit logï¼‰**ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚  
ãƒ­ã‚°ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚ˆã‚Šé•·ãæ®‹ã‚Šã€ç ”ç©¶å…±æœ‰ã•ã‚Œå¾—ã‚‹ãŸã‚ã€ãƒ­ã‚°ã‚’**ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãªæˆæœç‰©**ã¨ã—ã¦æ‰±ã†å‰æã§è¨­è¨ˆã—ã¦ãã ã•ã„ã€‚

- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ãƒ†ã‚¹ãƒˆãƒ™ã‚¯ã‚¿ï¼ãƒ­ã‚°ã« **å€‹äººæƒ…å ±ï¼ˆPIIï¼‰**ï¼ˆãƒ¡ãƒ¼ãƒ«ã€é›»è©±ç•ªå·ã€ä½æ‰€ã€å®Ÿåã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDç­‰ï¼‰ã‚’å…¥ã‚Œãªã„
- å®Ÿé¨“ã¯ **åˆæˆãƒ‡ãƒ¼ã‚¿ï¼ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿** ã‚’å„ªå…ˆ
- å®Ÿè¡Œæ™‚ãƒ­ã‚°ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼ˆå¿…è¦ãªã‚‰ **ãƒã‚¹ã‚­ãƒ³ã‚°ï¼ä¿æŒæœŸé™ï¼éš”é›¢ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**ã‚’é©ç”¨ï¼‰

### ğŸ”’ ç›£æŸ»ãƒ­ã‚°è¦ä»¶ï¼ˆMUSTï¼‰

ç ”ç©¶å…±æœ‰å¯èƒ½ã§å®‰å…¨ãªãƒ­ã‚°ã«ã™ã‚‹ãŸã‚ï¼š

- **MUST NOT**ï¼šPIIã‚„ç§˜å¯†æƒ…å ±ã‚’å«ã¿å¾—ã‚‹ raw ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼å‡ºåŠ›ã‚’æ°¸ç¶šåŒ–ã—ãªã„
- **MUST**ï¼šsanitized ãªè¨¼æ‹ ï¼ˆredacted / hashed / ã‚«ãƒ†ã‚´ãƒªä¿¡å·ï¼‰ã ã‘ã‚’ä¿å­˜ã™ã‚‹
- **MUST**ï¼šPIIæ§˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ fail-closed ã§èµ¤å¡—ã‚Šï¼ˆæ¤œçŸ¥å¤±æ•—æ™‚ã¯ãƒ­ã‚°ã‚’æ›¸ã‹ãªã„ï¼‰
- **MUST**ï¼šèµ¤å¡—ã‚Šã¯ **å€¤ã ã‘ã§ãªãè¾æ›¸ã‚­ãƒ¼ã«ã‚‚é©ç”¨**ï¼ˆ`@` ç­‰ãŒæ®‹å­˜ã—ãªã„ã“ã¨ï¼‰
- **MUST**ï¼šå®Ÿè¡Œæ™‚ãƒ­ã‚°ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«éš”é›¢ã‚’æ¨å¥¨ï¼‰

#### æœ€å°å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå®Ÿè£…æº–æ‹ , MUSTï¼‰

`run_id, ts, layer, decision, reason_code, sealed, overrideable, final_decider`

#### ä»»æ„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¿…è¦ãªã‚‰ SHOULDï¼‰

`session_id, policy_version, artifact_id, route_id`ï¼ˆã™ã¹ã¦ **éPIIãƒ»sanitized å‰æ**ï¼‰

#### ä¿æŒæœŸé™ï¼ˆSHOULDï¼‰

- 7 / 30 / 90 æ—¥ãªã©ä¿æŒæœŸé™ã‚’å®šç¾©ã—ã€è‡ªå‹•å‰Šé™¤ã™ã‚‹ã“ã¨ã€‚

---

## ğŸ§‘â€âš–ï¸ HITL ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ï¼ˆHITLå¾Œã®æŒ™å‹•ã‚’å®šç¾©ï¼‰

HITL ã¯æ›–æ˜§ãƒ»é«˜ãƒªã‚¹ã‚¯æ™‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚è²¬ä»»ã®æ‰€åœ¨ã¯ç›£æŸ»ãƒ­ã‚°ã§è¿½è·¡å¯èƒ½ã§ã‚ã‚‹ã¹ãã§ã™ã€‚

### HITL è¦æ±‚æ™‚ï¼ˆSYSTEMï¼‰

ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ `HITL_REQUESTEDï¼ˆSYSTEMï¼‰` ã‚’å‡ºåŠ›ã—ã€é€šå¸¸ä»¥ä¸‹ã‚’å«ã¿ã¾ã™ï¼š

- `decision=PAUSE_FOR_HITL`
- `sealed=false`
- `overrideable=true`

### HITL æ±ºå®šæ™‚ï¼ˆUSERï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸æŠã¯ `HITL_DECIDEDï¼ˆUSERï¼‰` ã¨ã—ã¦è¨˜éŒ²ã—ã¾ã™ï¼š

- `sealed=false`
- `overrideable=false`
- `final_decider=USER`

é¸æŠã®ä¼æ¬ï¼š

- **CONTINUE** â†’ æ±ºå®šã¯ `RUN` ã«ä¼æ¬
- **STOP** â†’ æ±ºå®šã¯ `STOPPED` ã¸

> æ³¨æ„ï¼š`sealed=true` ã«ãªã‚Œã‚‹ã®ã¯ **Ethics/ACC ã®ã¿**ï¼ˆã“ã®å ´åˆ `final_decider=SYSTEM`ï¼‰ã€‚

---

## âš™ï¸ å®Ÿè¡Œä¾‹ï¼ˆExecution Examplesï¼‰

> â€œpersuasion / reeducationâ€ ã‚’æƒ³èµ·ã•ã›ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ **å®‰å…¨è©•ä¾¡ç”¨é€”ã®ã¿**ã§ã€æ˜ç¤ºçš„ opt-in ãŒãªã„é™ã‚Š **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç„¡åŠ¹** ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

```bash
python ai_mediation_all_in_one.py
python kage_orchestrator_diverse_v1.py
python ai_governance_mediation_sim.py
