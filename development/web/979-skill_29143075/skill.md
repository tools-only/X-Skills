---
name: ai-ad-code-factory
version: "3.5"
status: ready_for_production
layer: skill
owner: wade
last_reviewed: 2025-12-24
baseline:
  - MASTER.md v3.5
  - CODE_FACTORY_REFERENCE_PROJECTS.md v1.0
  - AI_CODE_FACTORY_REFACTOR_PROPOSAL.md v1.0
  - code-blocks-registry.md v2.0
code_sources:
  - project: Anthropic autonomous-coding
    github: https://github.com/anthropics/claude-quickstarts/tree/main/autonomous-coding
    license: Internal (å‚è€ƒè®¾è®¡)
    borrowed_concepts:
      - åŒ Agent æ¨¡å¼ (Initializer + Factory)
      - task_list.json æŒä¹…åŒ–
      - ä¼šè¯ç®¡ç†ä¸æ¢å¤
      - Defense-in-Depth å®‰å…¨æ¨¡å‹
  - project: MetaGPT
    github: https://github.com/geekan/MetaGPT
    license: MIT
    borrowed_concepts:
      - å¤šè§’è‰² Agent åä½œæ¨¡å¼
      - æ ‡å‡†åŒ– SOP æµç¨‹
      - æ¶ˆæ¯ä¼ é€’æœºåˆ¶
  - project: OpenHands
    github: https://github.com/All-Hands-AI/OpenHands
    license: MIT
    borrowed_concepts:
      - Agent-Computer Interface (ACI) è®¾è®¡
      - äº‹ä»¶é©±åŠ¨æ¶æ„
  - project: SWE-agent
    github: https://github.com/princeton-nlp/SWE-agent
    license: MIT
    borrowed_concepts:
      - æ–‡ä»¶ç¼–è¾‘æ¥å£è®¾è®¡
      - é”™è¯¯ä¿®å¤å¾ªç¯
---

<skill>
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  AI ä»£ç å·¥å‚ v3.5 - å‰ç«¯è®¾è®¡é›†æˆç‰ˆ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  <name>ai-ad-code-factory</name>
  <version>3.5</version>
  <domain>AI_AD_SYSTEM / ä»£ç å·¥å‚ / è‡ªä¸»ç¼–ç </domain>
  <profile>Autonomous-Coding / Search-First / Session-Persistent / Design-Aware</profile>


  <!-- ======================================================
       0. ä»£ç æ¥æºè¯´æ˜ (Code Sources)
  ====================================================== -->
  <code_sources>
    æœ¬ Skill æ˜¯ä»£ç å·¥å‚çš„ä¸»ç¼–æ’å™¨ï¼Œæ•´åˆäº†ä»¥ä¸‹é¡¹ç›®çš„æ ¸å¿ƒè®¾è®¡ï¼š

    **æ ¸å¿ƒæ¶æ„ (v3.0 æ–°å¢)**:
    1. **Anthropic autonomous-coding** - https://github.com/anthropics/claude-quickstarts
       - åŒ Agent æ¨¡å¼ (Initializer + Coding Agent)
       - task_list.json æŒä¹…åŒ– (ä»»åŠ¡åªèƒ½ pending â†’ completed)
       - ä¼šè¯ç®¡ç†ä¸è‡ªåŠ¨æ¢å¤
       - Defense-in-Depth å®‰å…¨æ¨¡å‹ (ç™½åå• + æ²™ç®±)

    **å¤šè§’è‰²åä½œ**:
    2. **MetaGPT** (MIT) - https://github.com/geekan/MetaGPT
       - å¤šè§’è‰² Agent åä½œæ¨¡å¼
       - æ ‡å‡†åŒ– SOP (Standard Operating Procedure)
       - Stars: 45k+

    3. **OpenHands** (MIT) - https://github.com/All-Hands-AI/OpenHands
       - Agent-Computer Interface (ACI) è®¾è®¡
       - äº‹ä»¶é©±åŠ¨æ¶æ„
       - Stars: 38k+

    4. **SWE-agent** (MIT) - https://github.com/princeton-nlp/SWE-agent
       - æ–‡ä»¶ç¼–è¾‘æ¥å£
       - é”™è¯¯ä¿®å¤å¾ªç¯
       - Stars: 13k+

    **å­ Skill æ¥æº**:
    - CodeSearcherSkill: code-graph-rag, Aider
    - CodeSelectorSkill: MetaGPT, Devika (è‡ªç ”è§„åˆ™å¼•æ“)
    - CodeAdapterSkill: astx, refactor
    - CodeAssemblerSkill: Aider, Copier
    - CodeVerifierSkill: mypy, ruff
  </code_sources>


  <!-- ======================================================
       0.1 v3.0 æ¶æ„å›¾ (Architecture)
  ====================================================== -->
  <architecture>
    ```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    AI ä»£ç å·¥å‚ v3.0 (é›†æˆç‰ˆ)                      â”‚
    â”‚                 å€Ÿé‰´ Anthropic Autonomous Coding                 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                 â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚                Session 1: INITIALIZER                      â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
    â”‚  â”‚  â”‚ 1. è§£æéœ€æ±‚ (PromptStructurer)                       â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚ 2. æœç´¢å‚è€ƒä»£ç  (CodeSearcher)                       â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚ 3. ç”Ÿæˆ task_list.json (N ä¸ªå­ä»»åŠ¡)                  â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚ 4. åˆå§‹åŒ–é¡¹ç›®ç»“æ„ + Git                               â”‚ â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â–¼ (3ç§’è‡ªåŠ¨ç»§ç»­)                     â”‚
    â”‚                                                                 â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚                Session 2+: FACTORY AGENT                   â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
    â”‚  â”‚  â”‚                  6 é˜¶æ®µæµæ°´çº¿ (æ¯ä¸ªä»»åŠ¡)               â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚                                                      â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚   SEARCH â†’ SELECT â†’ ADAPT â†’ ASSEMBLE â†’ VERIFY â†’ CONFIRM â”‚ â”‚
    â”‚  â”‚  â”‚     â”‚        â”‚        â”‚         â”‚         â”‚        â”‚  â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚     â–¼        â–¼        â–¼         â–¼         â–¼        â–¼  â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚  Searcher Selector Adapter Assembler Verifier Confirmer â”‚ â”‚
    â”‚  â”‚  â”‚                                                      â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚  âœ… ä»»åŠ¡å®Œæˆ â†’ æ›´æ–° task_list.json â†’ Git commit      â”‚ â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                                 â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚                    å®‰å…¨æ¨¡å‹ (Defense-in-Depth)              â”‚ â”‚
    â”‚  â”‚  Layer 1: å‘½ä»¤ç™½åå• (security.py)                         â”‚ â”‚
    â”‚  â”‚  Layer 2: æ–‡ä»¶ç³»ç»Ÿé™åˆ¶ (project_dir only)                  â”‚ â”‚
    â”‚  â”‚  Layer 3: SoT åˆè§„éªŒè¯ (CodeVerifier)                      â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                                 â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚                    æŒä¹…åŒ– (Persistence)                     â”‚ â”‚
    â”‚  â”‚  - task_list.json: ä»»åŠ¡è¿›åº¦ (åªèƒ½ pending â†’ completed)     â”‚ â”‚
    â”‚  â”‚  - factory-progress.txt: ä¼šè¯è¿›åº¦ç¬”è®°                      â”‚ â”‚
    â”‚  â”‚  - Git commits: æ¯ä¸ªä»»åŠ¡ä¸€æ¬¡æäº¤                            â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ```

    **å®ç°æ–‡ä»¶**:
    ```
    agents/skills/code_factory/
    â”œâ”€â”€ __init__.py      # æ¨¡å—å¯¼å‡º
    â”œâ”€â”€ factory.py       # ä¸»ç¼–æ’å™¨ (CodeFactory)
    â”œâ”€â”€ task_list.py     # ä»»åŠ¡ç®¡ç† (TaskList)
    â”œâ”€â”€ session.py       # ä¼šè¯ç®¡ç† (SessionManager)
    â””â”€â”€ security.py      # å®‰å…¨éªŒè¯ (SecurityValidator)
    ```
  </architecture>


  <!-- ======================================================
       1. æ ¸å¿ƒä½¿å‘½ (Mission)
  ====================================================== -->
  <mission>
    ä½œä¸ºä»£ç ç»„è£…å™¨ï¼Œé€šè¿‡"æœç´¢â†’é€‰å‹â†’é€‚é…â†’ç»„è£…â†’éªŒè¯"çš„æµç¨‹ç”Ÿæˆä»£ç ã€‚

    æ ¸å¿ƒåŸåˆ™ï¼š
    - ğŸ” æœç´¢ä¼˜å…ˆ: å…ˆæ‰¾ç°æœ‰ä»£ç ï¼Œä¸ä»é›¶å†™
    - ğŸ”§ é€‚é…æ”¹è‰¯: åŸºäºå‚è€ƒä»£ç ä¿®æ”¹ï¼Œè€Œéå‡­ç©ºç”Ÿæˆ
    - ğŸ§© ç»„è£…é›†æˆ: å°†å¤šä¸ªç‰‡æ®µç»„è£…æˆå®Œæ•´åŠŸèƒ½
    - âœ… æ ‡æ³¨æ¥æº: æ‰€æœ‰ä»£ç éƒ½æ ‡æ³¨å‚è€ƒæ¥æº
    - ğŸ”„ éªŒè¯ä¿®å¤: è‡ªåŠ¨éªŒè¯å¹¶ä¿®å¤é—®é¢˜

    é¢„æœŸæ”¶ç›Šï¼š
    - ä»£ç æ¥å—ç‡: ~50% â†’ >80% (+60%)
    - å¹»è§‰å‘ç”Ÿç‡: ~30% â†’ <5% (-83%)
    - ä»£ç å¯è¿½æº¯æ€§: 0% â†’ 100%
  </mission>


  <!-- ======================================================
       2. å­ Skill ä¾èµ–
  ====================================================== -->
  <sub_skills>
    <skill name="ai-ad-prompt-structurer" priority="0">
      èŒè´£: å°†ç”¨æˆ·è‡ªç„¶è¯­è¨€éœ€æ±‚è½¬æ¢ä¸ºç»“æ„åŒ–æç¤ºè¯
      æ¥æº: LangChain, DSPy, Guidance
      è¯´æ˜: å‰ç½®å¤„ç†å™¨ï¼Œæé«˜ä»»åŠ¡æ‰§è¡Œå‡†ç¡®æ€§
    </skill>

    <skill name="ai-ad-code-searcher" priority="1">
      èŒè´£: ä»å¤šä¸ªæ¥æºæœç´¢å‚è€ƒä»£ç 
      æ¥æº: code-graph-rag, Aider
    </skill>

    <skill name="ai-ad-code-selector" priority="2">
      èŒè´£: è¯„ä¼°å€™é€‰ä»£ç ï¼Œé€‰æ‹©æœ€ä½³å‚è€ƒ
      æ¥æº: MetaGPT, Devika (è‡ªç ”)
    </skill>

    <skill name="ai-ad-code-adapter" priority="3">
      èŒè´£: é€‚é…å‚è€ƒä»£ç åˆ°é¡¹ç›®è§„èŒƒ
      æ¥æº: astx, refactor
    </skill>

    <skill name="ai-ad-code-assembler" priority="4">
      èŒè´£: ç»„è£…æˆå®Œæ•´åŠŸèƒ½æ¨¡å—
      æ¥æº: Aider, Copier
    </skill>

    <skill name="ai-ad-code-verifier" priority="5">
      èŒè´£: éªŒè¯ä»£ç è´¨é‡å¹¶è‡ªåŠ¨ä¿®å¤
      æ¥æº: mypy, ruff
    </skill>

    <skill name="frontend-design" priority="3.5">
      èŒè´£: å‰ç«¯ UI/UX è®¾è®¡æŒ‡å¯¼ï¼Œç¡®ä¿è®¾è®¡ç³»ç»Ÿä¸€è‡´æ€§
      æ¥æº: shadcn/ui, Tailwind CSS, WCAG 2.1
      è§¦å‘æ¡ä»¶: scope="frontend" æˆ– scope="fullstack"
      æ ¸å¿ƒåŠŸèƒ½:
        - è®¾è®¡ç³»ç»Ÿä¸€è‡´æ€§æ£€æŸ¥ (é¢œè‰²ã€é—´è·ã€å­—ä½“)
        - ç»„ä»¶å¤ç”¨æ€§å®¡æŸ¥ (ä½¿ç”¨ COMPONENT_REGISTRY.md)
        - å“åº”å¼è®¾è®¡éªŒè¯ (æ–­ç‚¹ç­–ç•¥)
        - å¯è®¿é—®æ€§æ£€æŸ¥ (a11y, WCAG 2.1 AA)
    </skill>
  </sub_skills>


  <!-- ======================================================
       2.1 AI é˜²å¹»è§‰åŸåˆ™ (Anti-Hallucination Principles)
       æ¥æº: MASTER.md v4.4 Â§7
  ====================================================== -->
  <anti_hallucination_principles>
    **æ ¸å¿ƒåŸåˆ™ (AH-01 ~ AH-05)** - BLOCKING çº§åˆ«

    æ¯æ¬¡ä»£ç ç”Ÿæˆå‰å¿…é¡»æ£€æŸ¥:

    | åŸåˆ™ | æ ‡é¢˜ | è§„åˆ™ | è¿ååæœ |
    |------|------|------|---------|
    | AH-01 | ç¦æ­¢å‡è®¾æ•°æ®ä¸€è‡´ | é‡åˆ°æ•°æ®ç¼ºå¤±ï¼Œæ ‡è®°"å¾…ç¡®è®¤"ï¼Œç¦æ­¢è‡ªåŠ¨å¡«å…… | BLOCKING |
    | AH-02 | ç¦æ­¢è‡ªåŠ¨åšç®¡ç†è£å†³ | ç¦æ­¢ç”Ÿæˆè‡ªåŠ¨æ‹’ç»/æš‚åœ/ç»ˆæ­¢/å†»ç»“ä»£ç  | BLOCKING |
    | AH-03 | ç¦æ­¢å¼•å…¥ SoT æœªå®šä¹‰æ¦‚å¿µ | å‘ç°ç¼ºå¤± â†’ ç«‹å³åœæ­¢ â†’ è¯¢é—®ç”¨æˆ· | BLOCKING |
    | AH-04 | å¿…é¡»éµå¾ª Phase 1 è½¯æ€§åŸåˆ™ | ä»…æç¤º+é«˜äº®+è®°å½•ï¼Œä¸é˜»æ–­ | WARNING |
    | AH-05 | é‡åˆ°æ­§ä¹‰å¿…é¡»åœæ­¢å¹¶è¯¢é—® | åœæ­¢ â†’ åˆ—å‡ºæ­§ä¹‰ç‚¹ â†’ è¯¢é—®ç”¨æˆ· | BLOCKING |

    **SoT è£åˆ¤é“¾ä¼˜å…ˆçº§** (é«˜ â†’ ä½):
    ```
    MASTER.md v4.4 â†’ DATA_SCHEMA.md v5.2 â†’ STATE_MACHINE.md v2.6
    â†’ BUSINESS_RULES.md v3.2 â†’ API_SOT.md v9.0 â†’ ERROR_CODES_SOT.md v2.1
    ```

    **å¸¸é‡ç™½åå•**:
    - æ—¥æŠ¥çŠ¶æ€: 8 ä¸ª (raw_submitted...final_locked)
    - ä¸šåŠ¡å±‚è§’è‰²: 6 ä¸ª (ceo, project_owner, finance, pitcher, account_manager, admin) - PRD v5.1
    - æŠ€æœ¯å±‚è§’è‰²: 4 ä¸ª (admin, finance, account_manager, media_buyer) - MASTER.md v4.6
    - é”™è¯¯ç å‰ç¼€: 16 ä¸ª (VAL, AUTH, BIZ, DB, INT, SYS, FIN, RPT, ACC, PRJ, PIT, TOP, IMP, EXP, REC, SET)

    **Phase 1 è¡Œä¸ºçº¦æŸ**:
    - âœ… å…è®¸: è®°å½•ã€æç¤ºã€é«˜äº®ã€ç»Ÿè®¡
    - âŒ ç¦æ­¢: é˜»æ–­ã€æ‹’ç»ã€æš‚åœã€å†»ç»“ã€è‡ªåŠ¨æ‰¹å‡†/æ‹’ç»

    **çŸ¥è¯†åº“è¯¦æƒ…**: knowledge/anti-hallucination-rules.md
  </anti_hallucination_principles>

  <!-- ======================================================
       2.2 ä»£ç å—ä¼˜å…ˆåŸåˆ™ (Code Blocks First) [v3.4 æ–°å¢]
       æ¥æº: knowledge/code-blocks-registry.md v2.0
  ====================================================== -->
  <code_blocks_first>
    **æ ¸å¿ƒåŸåˆ™**: ä»£ç å—ä¼˜å…ˆï¼Œå‡å°‘é‡å¤ç¼–å†™

    ### å¼ºåˆ¶è§„åˆ™ (BLOCKING)

    | è§„åˆ™ | æè¿° | è¿ååæœ |
    |------|------|---------|
    | CB-001 | ç”Ÿæˆä»£ç å‰ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢ä»£ç å—æ³¨å†Œè¡¨ | BLOCKING |
    | CB-002 | å¦‚æœå­˜åœ¨åŒ¹é…çš„ä»£ç å—ï¼Œå¿…é¡»ä½¿ç”¨ä»£ç å—ï¼Œç¦æ­¢é‡æ–°ç¼–å†™ | BLOCKING |
    | CB-003 | ä»£ç å—åªèƒ½æ‰©å±•ï¼Œä¸èƒ½ä¿®æ”¹æ ¸å¿ƒé€»è¾‘ | WARNING |
    | CB-004 | ä½¿ç”¨ä»£ç å—æ—¶å¿…é¡»æ ‡æ³¨ `# CodeBlock: {block_id}` | WARNING |

    ### ä»£ç å—ä¼˜å…ˆæŸ¥è¯¢æµç¨‹

    ```
    ç”¨æˆ·éœ€æ±‚ --> æå–å…³é”®è¯ --> æŸ¥è¯¢ä»£ç å—æ³¨å†Œè¡¨ --> åŒ¹é…æˆåŠŸ?
                                                    |
                                               æ˜¯ --> ä½¿ç”¨ä»£ç å—
                                               å¦ --> è¿›å…¥æœç´¢æµç¨‹
    ```

    ### ä»£ç å—æ³¨å†Œè¡¨ç´¢å¼• (16 ä¸ªä»£ç å—)

    **å‰ç«¯ä»£ç å— (8ä¸ª)**:
    | ID | åç§° | å…³é”®è¯ |
    |----|------|--------|
    | CB-FE-001 | DataTable | è¡¨æ ¼, åˆ—è¡¨, table, åˆ†é¡µ, æ’åº |
    | CB-FE-002 | StatusBadge | çŠ¶æ€, å¾½ç« , badge, æ ‡ç­¾ |
    | CB-FE-003 | DataState | åŠ è½½, loading, empty, skeleton |
    | CB-FE-004 | ActionButtons | æ“ä½œ, æŒ‰é’®, action, ç¡®è®¤ |
    | CB-FE-005 | GlobalFilters | ç­›é€‰, filter, æ—¥æœŸ, select |
    | CB-FE-006 | PageHeader | é¡µé¢æ ‡é¢˜, header, é¢åŒ…å±‘ |
    | CB-FE-007 | ApprovalTimeline | æ—¶é—´çº¿, timeline, å®¡æ‰¹æµç¨‹ |
    | CB-FE-008 | FormDialog | è¡¨å•, form, å¼¹çª—, dialog |

    **åç«¯ä»£ç å— (8ä¸ª)**:
    | ID | åç§° | å…³é”®è¯ |
    |----|------|--------|
    | CB-BE-001 | Pagination | åˆ†é¡µ, pagination, list |
    | CB-BE-002 | ResponseEnvelope | å“åº”, response, å°è£… |
    | CB-BE-003 | ErrorCodes | é”™è¯¯, error, å¼‚å¸¸ |
    | CB-BE-004 | PermissionFilter | æƒé™, permission, è¿‡æ»¤, role |
    | CB-BE-005 | StateMachine | çŠ¶æ€æœº, state, transition |
    | CB-BE-006 | AuditLog | å®¡è®¡, audit, æ—¥å¿—, history |
    | CB-BE-007 | LedgerEntry | è´¦æœ¬, ledger, ä½™é¢, balance |
    | CB-BE-008 | KPICalculator | KPI, ROAS, CPL, CPA, æŒ‡æ ‡ |

    **è¯¦ç»†ä»£ç æ¨¡æ¿**: knowledge/code-blocks-registry.md
  </code_blocks_first>




  <!-- ======================================================
       3. è¾“å…¥å¥‘çº¦ (Input Contract)
  ====================================================== -->
  <input_contract>
    å¿…å¡«:
    {
      requirement: string,  // éœ€æ±‚æè¿°
      module: "pitcher" | "finance" | "ad_account" | "project"  // æ ¸å¿ƒæ¨¡å— (å¿…å¡«!)
    }

    å¯é€‰:
    {
      scope: "backend" | "frontend" | "fullstack",  // æŠ€æœ¯èŒƒå›´ (é»˜è®¤ fullstack)
      search_sources: {                              // æœç´¢æ¥æº
        local_project: boolean,                      // é»˜è®¤ true
        code_library: boolean,                       // é»˜è®¤ true
        github: boolean                              // é»˜è®¤ false
      },
      auto_fix_iterations: number,                   // è‡ªåŠ¨ä¿®å¤æ¬¡æ•° (é»˜è®¤ 3)
      output_mode: "files" | "diff" | "preview"      // è¾“å‡ºæ¨¡å¼ (é»˜è®¤ files)
    }

    æ¨¡å—è¾¹ç•Œå®šä¹‰ (STATE_MACHINE.md v2.6 Â§2 è§’è‰²ä¸æ¨¡å—æƒé™):
    {
      pitcher: {
        å¯å†™è¡¨: [daily_reports, pitchers(ä»…è‡ªå·±)],
        åªè¯»è¡¨: [account_ownership_history, ad_accounts, projects],
        ç¦æ­¢è¡¨: [ledger, period_locks, recon_*]
      },
      finance: {
        å¯å†™è¡¨: [ledger(ä»…INSERT), period_locks, recon_*],
        åªè¯»è¡¨: [daily_reports, ad_accounts, agencies],
        ç¦æ­¢è¡¨: [pitchers(å†™)]
      },
      ad_account: {
        å¯å†™è¡¨: [ad_accounts, agencies, account_ownership_history, attribution_*, spend_*],
        åªè¯»è¡¨: [pitchers, projects],
        ç¦æ­¢è¡¨: [ledger, daily_reports(å†™), period_locks]
      },
      project: {
        å¯å†™è¡¨: [projects, clients],
        åªè¯»è¡¨: [pitchers, ad_accounts],
        ç¦æ­¢è¡¨: [ledger, daily_reports(å†™), account_ownership_history(å†™)]
      }
    }
  </input_contract>


  <!-- ======================================================
       4. è¾“å‡ºå¥‘çº¦ (Output Contract)
  ====================================================== -->
  <output_contract>
    {
      success: boolean,
      data: {
        // Phase 1: æœç´¢ç»“æœ
        search_results: {
          candidates: SearchCandidate[],
          search_stats: SearchStats
        },

        // Phase 2: é€‰å‹ç»“æœ
        selection: {
          selected: SearchCandidate,
          scores: EvaluationScores,
          adaptation_plan: AdaptationPlan
        },

        // Phase 3: é€‚é…ç»“æœ
        adaptation: {
          adapted_files: AdaptedFile[],
          summary: AdaptationSummary
        },

        // Phase 4: ç»„è£…ç»“æœ
        assembly: {
          module: AssembledModule,
          repo_map: RepoMap,
          integration_guide: IntegrationGuide
        },

        // Phase 5: éªŒè¯ç»“æœ
        verification: {
          verified_files: VerifiedFile[],
          report: VerificationReport,
          remaining_issues: Issue[]
        },

        // æœ€ç»ˆè¾“å‡º
        final_files: [
          {
            path: string,
            content: string,
            action: "create" | "modify",
            source_refs: string[]
          }
        ]
      },
      error: string | null
    }
  </output_contract>


  <!-- ======================================================
       5. å·¥ä½œæµç¨‹ (Workflow)
  ====================================================== -->
  <workflow>
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    ä»£ç å·¥å‚å·¥ä½œæµç¨‹                               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                 â”‚
    â”‚  è¾“å…¥: requirement = "æ·»åŠ æ—¥æŠ¥æ‰¹é‡å¯¼å‡º Excel åŠŸèƒ½"               â”‚
    â”‚                                                                 â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ Phase 1: SEARCH (æœç´¢)                                   â”‚   â”‚
    â”‚  â”‚ Skill: ai-ad-code-searcher                               â”‚   â”‚
    â”‚  â”‚ æ¥æº: code-graph-rag, Aider                              â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ åŠ¨ä½œ:                                                    â”‚   â”‚
    â”‚  â”‚ 1. æå–å…³é”®è¯: [å¯¼å‡º, export, excel, æ‰¹é‡, batch]        â”‚   â”‚
    â”‚  â”‚ 2. æœç´¢æœ¬é¡¹ç›®: â†’ æ‰¾åˆ° batch_import å¯å‚è€ƒ                â”‚   â”‚
    â”‚  â”‚ 3. æœç´¢ä»£ç èµ„æ–™åº“: â†’ æ‰¾åˆ° fastapi-excel å‚è€ƒå®ç°         â”‚   â”‚
    â”‚  â”‚ 4. æœç´¢ GitHub (å¯é€‰): â†’ è¡¥å……æœç´¢                        â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ è¾“å‡º: å€™é€‰ä»£ç åˆ—è¡¨ (æŒ‰ç›¸å…³åº¦æ’åº)                        â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â–¼                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ Phase 2: SELECT (é€‰å‹)                                   â”‚   â”‚
    â”‚  â”‚ Skill: ai-ad-code-selector                               â”‚   â”‚
    â”‚  â”‚ æ¥æº: MetaGPT, Devika                                    â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ åŠ¨ä½œ:                                                    â”‚   â”‚
    â”‚  â”‚ 1. æŠ€æœ¯æ ˆåŒ¹é…åº¦è¯„ä¼° (30%)                                â”‚   â”‚
    â”‚  â”‚ 2. åŠŸèƒ½è¦†ç›–åº¦è¯„ä¼° (30%)                                  â”‚   â”‚
    â”‚  â”‚ 3. é€‚é…æˆæœ¬è¯„ä¼° (25%)                                    â”‚   â”‚
    â”‚  â”‚ 4. ä»£ç è´¨é‡è¯„ä¼° (15%)                                    â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ è¾“å‡º: æœ€ä½³å‚è€ƒ + é€‚é…æ–¹æ¡ˆ                                â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â–¼                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ Phase 3: ADAPT (é€‚é…)                                    â”‚   â”‚
    â”‚  â”‚ Skill: ai-ad-code-adapter                                â”‚   â”‚
    â”‚  â”‚ æ¥æº: astx, refactor                                     â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ åŠ¨ä½œ:                                                    â”‚   â”‚
    â”‚  â”‚ 1. æŠ€æœ¯æ ˆé€‚é… (Pydantic v2, SQLAlchemy 2.x)             â”‚   â”‚
    â”‚  â”‚ 2. é¡¹ç›®è§„èŒƒé€‚é… (å“åº”æ ¼å¼, é”™è¯¯ç , å‘½å)                 â”‚   â”‚
    â”‚  â”‚ 3. SoT åˆè§„é€‚é… (å­—æ®µ/çŠ¶æ€/ç±»å‹)                         â”‚   â”‚
    â”‚  â”‚ 4. åŠŸèƒ½å®šåˆ¶ (æŒ‰éœ€æ±‚è°ƒæ•´)                                 â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ è¾“å‡º: é€‚é…åçš„ä»£ç  (æ ‡æ³¨æ‰€æœ‰æ”¹åŠ¨ç‚¹)                      â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â–¼                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ Phase 4: ASSEMBLE (ç»„è£…)                                 â”‚   â”‚
    â”‚  â”‚ Skill: ai-ad-code-assembler + frontend-design            â”‚   â”‚
    â”‚  â”‚ æ¥æº: Aider, Copier, shadcn/ui                           â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ åŠ¨ä½œ:                                                    â”‚   â”‚
    â”‚  â”‚ 1. ç”Ÿæˆ Repo Map (é¡¹ç›®ç»“æ„å›¾)                            â”‚   â”‚
    â”‚  â”‚ 2. åç«¯ç»„è£…: Schema â†’ Service â†’ Router                   â”‚   â”‚
    â”‚  â”‚ 3. å‰ç«¯ç»„è£…: Types â†’ API â†’ Hooks â†’ Components â†’ Page     â”‚   â”‚
    â”‚  â”‚ 4. [å‰ç«¯] è°ƒç”¨ frontend-design è¿›è¡Œè®¾è®¡å®¡æŸ¥              â”‚   â”‚
    â”‚  â”‚    - è®¾è®¡ç³»ç»Ÿä¸€è‡´æ€§ (é¢œè‰²/é—´è·/å­—ä½“)                     â”‚   â”‚
    â”‚  â”‚    - ç»„ä»¶å¤ç”¨æ€§éªŒè¯                                      â”‚   â”‚
    â”‚  â”‚    - å“åº”å¼å¸ƒå±€æ£€æŸ¥                                      â”‚   â”‚
    â”‚  â”‚    - å¯è®¿é—®æ€§ (a11y) éªŒè¯                                â”‚   â”‚
    â”‚  â”‚ 5. ç”Ÿæˆé›†æˆæŒ‡å—                                          â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ è¾“å‡º: å®Œæ•´åŠŸèƒ½æ¨¡å— + è®¾è®¡å®¡æŸ¥æŠ¥å‘Š                        â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â–¼                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ Phase 5: VERIFY (éªŒè¯)                                   â”‚   â”‚
    â”‚  â”‚ Skill: ai-ad-code-verifier                               â”‚   â”‚
    â”‚  â”‚ æ¥æº: mypy, ruff                                         â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ åŠ¨ä½œ:                                                    â”‚   â”‚
    â”‚  â”‚ 1. ç±»å‹æ£€æŸ¥ (mypy/tsc)                                  â”‚   â”‚
    â”‚  â”‚ 2. Lint æ£€æŸ¥ (ruff/eslint)                              â”‚   â”‚
    â”‚  â”‚ 3. SoT åˆè§„æ£€æŸ¥                                          â”‚   â”‚
    â”‚  â”‚ 4. è‡ªåŠ¨ä¿®å¤ (æœ€å¤š 3 æ¬¡è¿­ä»£)                              â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ å¤±è´¥ â†’ å›åˆ° ADAPT ä¿®å¤                                   â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â–¼                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚ Phase 6: CONFIRM (å¹»è§‰æŠ‘åˆ¶æœ€ç»ˆç¡®è®¤) [v3.1 æ–°å¢]          â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ åŠ¨ä½œ:                                                    â”‚   â”‚
    â”‚  â”‚ 1. éå†ç”Ÿæˆçš„æ¯ä¸ªçŠ¶æ€å€¼ â†’ è¿½æº¯åˆ° STATE_MACHINE.md       â”‚   â”‚
    â”‚  â”‚ 2. éå†ç”Ÿæˆçš„æ¯ä¸ªè§’è‰²å€¼ â†’ è¿½æº¯åˆ° frozenset ç™½åå•       â”‚   â”‚
    â”‚  â”‚ 3. éå†ç”Ÿæˆçš„æ¯ä¸ªå­—æ®µ â†’ è¿½æº¯åˆ° DATA_SCHEMA.md           â”‚   â”‚
    â”‚  â”‚ 4. éå†è°ƒç”¨çš„æ¯ä¸ª API â†’ ç¡®è®¤åœ¨é¡¹ç›®ä¸­å­˜åœ¨                 â”‚   â”‚
    â”‚  â”‚ 5. ç”Ÿæˆæ¥æºè¿½æº¯æŠ¥å‘Š (source_traceability_report)        â”‚   â”‚
    â”‚  â”‚                                                         â”‚   â”‚
    â”‚  â”‚ ä»»ä½•è¿½æº¯å¤±è´¥ â†’ BLOCKINGï¼Œå¿…é¡»äººå·¥ä»‹å…¥                    â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚                              â”‚                                  â”‚
    â”‚                              â–¼                                  â”‚
    â”‚  è¾“å‡º:                                                          â”‚
    â”‚  - å¯ç”¨ä»£ç æ–‡ä»¶                                                 â”‚
    â”‚  - å‚è€ƒæ¥æºè¯´æ˜                                                 â”‚
    â”‚  - æ”¹åŠ¨è¯´æ˜                                                     â”‚
    â”‚  - é›†æˆæŒ‡å—                                                     â”‚
    â”‚                                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  </workflow>


  <!-- ======================================================
       5.1 ä»£ç æ¥æºæ ‡æ³¨è§„èŒƒ (Source Annotation Standard) [v3.2 æ–°å¢]
  ====================================================== -->
  <source_annotation_standard>
    æ‰€æœ‰ç”Ÿæˆçš„ä»£ç å¿…é¡»ä½¿ç”¨ç»Ÿä¸€çš„æ¥æºæ ‡æ³¨æ ¼å¼:

    **æ ‡å‡†æ ¼å¼**: `# SoT: {DOC}#{SECTION}`

    ç¤ºä¾‹:
    ```python
    # SoT: STATE_MACHINE.md#daily_report
    class ReportStatus(str, Enum):
        DRAFT = "DRAFT"
        SUBMITTED = "SUBMITTED"
        ...

    # SoT: DATA_SCHEMA.md#daily_reports.amount
    amount: Decimal = Field(..., description="æ¶ˆè€—é‡‘é¢")

    # SoT: BUSINESS_RULES.md#BR-RPT-001
    def validate_report_date(self, date: date) -> bool:
        ...

    # SoT: ERROR_CODES_SOT.md#RPT-001
    raise BusinessError(code="RPT-001", message="æ—¥æŠ¥æ—¥æœŸä¸èƒ½æ˜¯æœªæ¥")

    # SoT: API_SOT.md#POST /daily-reports
    @router.post("/daily-reports")
    async def create_daily_report(...):
        ...
    ```

    **TypeScript/TSX æ ¼å¼**:
    ```typescript
    // SoT: STATE_MACHINE.md#daily_report
    type ReportStatus = "DRAFT" | "SUBMITTED" | "CONFIRMED";

    // SoT: API_SOT.md#GET /daily-reports
    export async function fetchDailyReports(): Promise<DailyReport[]> {
        ...
    }
    ```

    **ç¦æ­¢çš„æ ¼å¼** (ä¼šè§¦å‘ SUP-007):
    - `# æ¥æº: xxx` âŒ
    - `// Source: xxx` âŒ
    - `/* Ref: xxx */` âŒ
    - æ— æ¥æºæ ‡æ³¨ âŒ

    **éªŒè¯è§„åˆ™**:
    - æ¯ä¸ªçŠ¶æ€æšä¸¾å¿…é¡»æœ‰ SoT æ ‡æ³¨
    - æ¯ä¸ªä¸šåŠ¡è§„åˆ™å®ç°å¿…é¡»æœ‰ BR-XXX å¼•ç”¨
    - æ¯ä¸ª API ç«¯ç‚¹å¿…é¡»æœ‰ API_SOT å¼•ç”¨
    - æ¯ä¸ªé”™è¯¯ç å¿…é¡»æœ‰ ERROR_CODES_SOT å¼•ç”¨
  </source_annotation_standard>


  <!-- ======================================================
       6. ç¦æ­¢è¡Œä¸º (Forbidden Actions)
  ====================================================== -->
  <forbidden_actions>
    <!-- æ¨¡å—è¾¹ç•Œè§„åˆ™ (STATE_MACHINE.md v2.6 Â§2) -->
    <forbidden id="CF-001">
      <action>ä¸æŒ‡å®š module å‚æ•°ç›´æ¥ç”Ÿæˆä»£ç </action>
      <correct_action>å¿…é¡»æŒ‡å®š module: pitcher | finance | ad_account | project</correct_action>
      <reason>æ¨¡å—è¾¹ç•Œæ˜¯é˜²æ­¢ AI å¹»è§‰çš„æ ¸å¿ƒçº¦æŸ</reason>
    </forbidden>

    <forbidden id="CF-002">
      <action>è·¨æ¨¡å—å†™å…¥æ•°æ®è¡¨</action>
      <correct_action>åªèƒ½å†™å…¥æ‰€å±æ¨¡å—çš„å¯å†™è¡¨</correct_action>
      <reason>æ¨¡å—éš”ç¦»æ˜¯ç³»ç»Ÿå®Œæ•´æ€§çš„ä¿éšœ (ZT-06)</reason>
    </forbidden>

    <forbidden id="CF-003">
      <action>åœ¨æ²¡æœ‰æœç´¢çš„æƒ…å†µä¸‹ç›´æ¥ç”Ÿæˆä»£ç </action>
      <correct_action>å¿…é¡»å…ˆæ‰§è¡Œ SEARCH Phase</correct_action>
      <reason>æœç´¢ä¼˜å…ˆæ˜¯å‡å°‘å¹»è§‰çš„æ ¸å¿ƒåŸåˆ™</reason>
    </forbidden>

    <forbidden id="CF-004">
      <action>ä¸æ ‡æ³¨ä»£ç æ¥æº</action>
      <correct_action>æ‰€æœ‰ä»£ç å¿…é¡»æ ‡æ³¨æ¥æº</correct_action>
      <reason>æ¥æºè¿½æº¯æ˜¯ä»£ç å¯ä¿¡åº¦çš„åŸºç¡€</reason>
    </forbidden>

    <forbidden id="CF-005">
      <action>å‘æ˜æ–°çš„å­—æ®µ/çŠ¶æ€/é”™è¯¯ç /è§’è‰²</action>
      <correct_action>ä»…ä½¿ç”¨ SoT ç™½åå•ä¸­å·²å®šä¹‰çš„å€¼</correct_action>
      <reason>SoT åˆè§„æ˜¯ç³»ç»Ÿä¸€è‡´æ€§çš„ä¿éšœ (ZT-02)</reason>
    </forbidden>

    <forbidden id="CF-006">
      <action>è·³è¿‡éªŒè¯é˜¶æ®µ</action>
      <correct_action>å¿…é¡»æ‰§è¡Œ VERIFY Phase</correct_action>
      <reason>éªŒè¯æ˜¯ä»£ç è´¨é‡çš„æœ€åé˜²çº¿</reason>
    </forbidden>

    <forbidden id="CF-007">
      <action>æ— é™å¾ªç¯ä¿®å¤</action>
      <correct_action>æœ€å¤š 3 æ¬¡ä¿®å¤è¿­ä»£ï¼Œå¤±è´¥åˆ™äººå·¥ä»‹å…¥</correct_action>
      <reason>é¿å…æ­»å¾ªç¯ï¼ŒåŠæ—¶å‘ç°æ ¹æœ¬é—®é¢˜</reason>
    </forbidden>

    <!-- è´¢åŠ¡æ¨¡å—ç‰¹æ®Šè§„åˆ™ -->
    <forbidden id="CF-008">
      <action>UPDATE/DELETE ledger è¡¨</action>
      <correct_action>åªèƒ½ INSERTï¼Œé”™è¯¯ä¿®æ­£ä½¿ç”¨å†²æ­£æœºåˆ¶</correct_action>
      <reason>è´¦æœ¬ä¸å¯å˜æ˜¯è´¢åŠ¡åˆè§„çš„åŸºç¡€ (ZT-01)</reason>
    </forbidden>

    <forbidden id="CF-009">
      <action>ç›´æ¥ä¿®æ”¹ balance å­—æ®µ</action>
      <correct_action>é€šè¿‡ ledger æµæ°´è®¡ç®—ä½™é¢</correct_action>
      <reason>ä½™é¢å¿…é¡»å¯è¿½æº¯ (ZT-05)</reason>
    </forbidden>
  </forbidden_actions>


  <!-- ======================================================
       7. ä½¿ç”¨ç¤ºä¾‹ (Usage Examples)
  ====================================================== -->
  <usage>
    **Claude Code ä½¿ç”¨æ–¹å¼** (æ¨è):

    ç¤ºä¾‹ 1: åŸºç¡€ä½¿ç”¨
    ã€Œ
    ä½¿ç”¨ ai-ad-code-factoryï¼Œ
    requirement = "æ·»åŠ æ—¥æŠ¥æ‰¹é‡å¯¼å‡º Excel åŠŸèƒ½ï¼Œæ”¯æŒæŒ‰æ—¥æœŸå’ŒçŠ¶æ€ç­›é€‰"
    ã€

    ç¤ºä¾‹ 2: ä»…åç«¯
    ã€Œ
    ä½¿ç”¨ ai-ad-code-factoryï¼Œ
    requirement = "æ·»åŠ æ—¥æŠ¥å¯¼å‡º API æ¥å£"ï¼Œ
    scope = "backend"
    ã€

    ç¤ºä¾‹ 3: ä»…æœç´¢æœ¬é¡¹ç›®
    ã€Œ
    ä½¿ç”¨ ai-ad-code-factoryï¼Œ
    requirement = "å‚è€ƒç°æœ‰æ‰¹é‡å¯¼å…¥å®ç°æ‰¹é‡å¯¼å‡º"ï¼Œ
    search_sources = {
      local_project: true,
      code_library: false,
      github: false
    }
    ã€

    **Python ä»£ç ä½¿ç”¨** (v3.0 æ–°å¢):

    ```python
    from agents.skills.code_factory import CodeFactory, FactoryConfig
    from pathlib import Path

    # åˆ›å»ºé…ç½®
    config = FactoryConfig(
        project_dir=Path("./my_project"),
        max_iterations=10,      # æœ€å¤šæ‰§è¡Œ 10 è½®
        auto_continue=True,     # è‡ªåŠ¨ç»§ç»­
        enable_security=True,   # å¯ç”¨å®‰å…¨æ£€æŸ¥
        enable_sot_check=True,  # å¯ç”¨ SoT åˆè§„æ£€æŸ¥
    )

    # åˆ›å»ºå·¥å‚å®ä¾‹
    factory = CodeFactory(config)

    # è¿è¡Œ (é¦–æ¬¡ä¼šè¿›å…¥åˆå§‹åŒ–ä¼šè¯)
    result = factory.run(requirement="æ·»åŠ ç”¨æˆ·ç™»å½• API")

    # æ£€æŸ¥ç»“æœ
    if result["success"]:
        print(f"å®Œæˆ {result['tasks_executed']} ä¸ªä»»åŠ¡")
    else:
        print(f"é”™è¯¯: {result['error']}")

    # æ¢å¤æ‰§è¡Œ (ä¸­æ–­åå†æ¬¡è¿è¡Œ)
    result = factory.run()  # æ— éœ€ requirementï¼Œè‡ªåŠ¨ä» task_list.json æ¢å¤
    ```

    **å¿«æ·å‡½æ•°**:
    ```python
    from agents.skills.code_factory import run_factory

    result = run_factory(
        project_dir="./my_project",
        requirement="æ·»åŠ æ—¥æŠ¥å¯¼å‡ºåŠŸèƒ½",
        max_iterations=5,
    )
    ```

    **å•ç‹¬ä½¿ç”¨ç»„ä»¶**:
    ```python
    from agents.skills.code_factory import TaskList, SecurityValidator

    # ä»»åŠ¡åˆ—è¡¨ç®¡ç†
    tasks = TaskList(Path("./my_project"))
    next_task = tasks.get_next_task()
    tasks.complete_task(next_task.id, output_files=["file.py"])

    # å®‰å…¨éªŒè¯
    validator = SecurityValidator(Path("./my_project"))
    result = validator.validate_command("rm -rf /")
    # result.allowed = False, result.reason = "å‘½ä»¤ 'rm -rf' è¢«ç¦æ­¢æ‰§è¡Œ"
    ```
  </usage>


  <!-- ======================================================
       8. ç‰ˆæœ¬è®°å½• (Version Notes)
  ====================================================== -->
  <VERSION_NOTES>
    ### v3.5 (2026-01-02) - å‰ç«¯è®¾è®¡é›†æˆç‰ˆ
    - æ–°å¢ `frontend-design` å­æŠ€èƒ½ (priority="3.5")
    - è§¦å‘æ¡ä»¶: scope="frontend" æˆ– scope="fullstack"
    - Phase 4 ASSEMBLE é˜¶æ®µæ–°å¢å‰ç«¯è®¾è®¡å®¡æŸ¥:
      - è®¾è®¡ç³»ç»Ÿä¸€è‡´æ€§æ£€æŸ¥ (é¢œè‰²/é—´è·/å­—ä½“)
      - ç»„ä»¶å¤ç”¨æ€§éªŒè¯ (ä½¿ç”¨ COMPONENT_REGISTRY.md)
      - å“åº”å¼è®¾è®¡éªŒè¯ (æ–­ç‚¹ç­–ç•¥)
      - å¯è®¿é—®æ€§æ£€æŸ¥ (a11y, WCAG 2.1 AA)
    - Profile æ›´æ–°: æ–°å¢ Design-Aware æ ‡ç­¾
    - è¾“å‡ºæ–°å¢: è®¾è®¡å®¡æŸ¥æŠ¥å‘Š

    ### v3.4 (2025-12-24) - ä»£ç å—ä¼˜å…ˆç‰ˆ
    - æ–°å¢ `<code_blocks_first>` ç« èŠ‚
    - æ–°å¢ Phase 0: CODE BLOCKS CHECK (ä»£ç å—æ£€æŸ¥)
    - é›†æˆä»£ç å—æ³¨å†Œè¡¨ (knowledge/code-blocks-registry.md)
    - 16 ä¸ªä»£ç å—ç´¢å¼• (å‰ç«¯ 8 ä¸ª + åç«¯ 8 ä¸ª)
    - å¼ºåˆ¶è§„åˆ™: CB-001 ~ CB-004
    - æ ¸å¿ƒåŸåˆ™: ä»£ç å—ä¼˜å…ˆï¼Œå‡å°‘é‡å¤ç¼–å†™

    ### v3.3 (2025-12-24) - é˜²å¹»è§‰è§„åˆ™é›†æˆç‰ˆ
    - æ–°å¢ `<anti_hallucination_principles>` ç« èŠ‚
    - é›†æˆ MASTER.md v4.4 Â§7 çš„ AI é˜²å¹»è§‰åŸåˆ™ (AH-01 ~ AH-05)
    - æ·»åŠ  SoT è£åˆ¤é“¾ä¼˜å…ˆçº§è¯´æ˜
    - æ·»åŠ å¸¸é‡ç™½åå•å¿«é€Ÿå‚è€ƒ
    - æ·»åŠ  Phase 1 è¡Œä¸ºçº¦æŸ
    - çŸ¥è¯†åº“: knowledge/anti-hallucination-rules.md

    ### v3.2 (2025-12-22) - P2 ä¼˜åŒ–ç‰ˆ
    - æ–°å¢ä»£ç æ¥æºæ ‡æ³¨è§„èŒƒ (source_annotation_standard)
    - ç»Ÿä¸€æ ¼å¼: `# SoT: {DOC}#{SECTION}`
    - æ–°å¢ SUP-007 é”™è¯¯ç  (éæ ‡å‡†æ¥æºæ ‡æ³¨)

    ### v3.1 (2025-12-22) - P1 ä¿®å¤ç‰ˆ
    - æ–°å¢ Phase 6: CONFIRM (å¹»è§‰æŠ‘åˆ¶æœ€ç»ˆç¡®è®¤)
    - 6 é˜¶æ®µæµæ°´çº¿: SEARCH â†’ SELECT â†’ ADAPT â†’ ASSEMBLE â†’ VERIFY â†’ CONFIRM
    - æ¥æºè¿½æº¯æŠ¥å‘Š (source_traceability_report)
    - ä»»ä½•è¿½æº¯å¤±è´¥ä¸º BLOCKING çº§åˆ«

    ### v3.0 (2025-12-18) - è‡ªä¸»ç¼–ç é›†æˆç‰ˆ
    - **æ ¸å¿ƒæ”¹è¿›**: é›†æˆ Anthropic autonomous-coding æ¶æ„
      - åŒ Agent æ¨¡å¼ (Initializer + Factory)
      - task_list.json æŒä¹…åŒ– (ä»»åŠ¡åªèƒ½ pending â†’ completed)
      - ä¼šè¯ç®¡ç†ä¸è‡ªåŠ¨æ¢å¤ (Ctrl+C ä¸­æ–­åå¯ç»§ç»­)
      - Defense-in-Depth å®‰å…¨æ¨¡å‹

    - **æ–°å¢ç»„ä»¶**:
      - `factory.py` - ä¸»ç¼–æ’å™¨ (CodeFactory)
      - `task_list.py` - ä»»åŠ¡ç®¡ç† (TaskList)
      - `session.py` - ä¼šè¯ç®¡ç† (SessionManager)
      - `security.py` - å®‰å…¨éªŒè¯ (SecurityValidator)

    - **æ ¸å¿ƒè®¾è®¡åŸåˆ™**:
      - ä»»åŠ¡åªèƒ½ `pending â†’ completed`ï¼Œç¦æ­¢åˆ é™¤/ä¿®æ”¹
      - æ¯ä¸ªä¼šè¯ä½¿ç”¨æ–°çš„ä¸Šä¸‹æ–‡çª—å£
      - 3 ç§’è‡ªåŠ¨ç»§ç»­å»¶è¿Ÿ
      - æœ€å¤š 3 æ¬¡è‡ªåŠ¨ä¿®å¤è¿­ä»£

    ### v2.0 (2025-12-17)
    - é‡æ„ä¸ºç»„è£…å™¨æ¶æ„ (SEARCH â†’ SELECT â†’ ADAPT â†’ ASSEMBLE â†’ VERIFY)
    - æ·»åŠ è¯¦ç»†ä»£ç æ¥æºæ ‡æ³¨
    - å€Ÿé‰´å¼€æºé¡¹ç›®:
      - MetaGPT: å¤šè§’è‰²åä½œ
      - OpenHands: ACI è®¾è®¡
      - SWE-agent: é”™è¯¯ä¿®å¤å¾ªç¯
      - code-graph-rag: è¯­ä¹‰æœç´¢
      - Aider: Repo Map + å¤šæ–‡ä»¶ç¼–è¾‘
      - astx/refactor: ä»£ç è½¬æ¢
      - mypy/ruff: ä»£ç éªŒè¯

    ### v1.0 (2024-xx-xx)
    - åˆå§‹ç‰ˆæœ¬ (ä»é›¶ç”Ÿæˆæ¨¡å¼)
  </VERSION_NOTES>

</skill>
